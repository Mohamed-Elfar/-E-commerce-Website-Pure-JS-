import{showToast as e}from"/assets/js/utils.js";0===JSON.parse(localStorage.getItem("cart")||"[]").length&&(location.href="/customer/home/home.html"),window.addEventListener("load",(function(){const t=document.querySelector(".needs-validation"),s=document.getElementById("externalSubmit");if(s&&t){const n=document.getElementById("cc-name"),a=document.getElementById("cc-number"),i=document.getElementById("cc-expiration"),l=document.getElementById("cc-cvv");[n,a,i,l].forEach((e=>{e.addEventListener("input",(()=>{e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.remove("is-valid")}))})),s.addEventListener("click",(function(s){s.preventDefault(),t.classList.remove("was-validated");const o=(c=n.value,/^[a-zA-Z\s]+$/.test(c));var c;const d=(r=a.value,/^[0-9]{4}\s?[0-9]{4}\s?[0-9]{4}\s?[0-9]{4}$/.test(r)||/^[0-9]{16}$/.test(r));var r;const u=function(e){if(!/^(0[1-9]|1[0-2])\/?([0-9]{2})$/.test(e))return!1;const[t,s]=e.split(/\D/),n=(new Date).getFullYear()%100,a=(new Date).getMonth()+1;return+s>n||+s===n&&+t>=a}(i.value),m=function(e){return/^[0-9]{3,4}$/.test(e)}(l.value);if(o?n.classList.add("is-valid"):(n.setCustomValidity("Please enter a valid name (letters only)"),n.classList.add("is-invalid")),d?a.classList.add("is-valid"):(a.setCustomValidity("Please enter a valid 16-digit card number"),a.classList.add("is-invalid")),u?i.classList.add("is-valid"):(i.setCustomValidity("Please enter a valid future date (MM/YY)"),i.classList.add("is-invalid")),m?l.classList.add("is-valid"):(l.setCustomValidity("Please enter a valid 3 or 4-digit CVV"),l.classList.add("is-invalid")),t.classList.add("was-validated"),o&&d&&u&&m){const p=localStorage.getItem("token");if(!p)return e("error","Please Login First"),void setTimeout((()=>open("/customer/home/home.html","_self")),2e3);const v=JSON.parse(localStorage.getItem("cart"))||[],h=JSON.parse(localStorage.getItem("allProducts"))||[],f=JSON.parse(localStorage.getItem("users"))||[],y=f.find((e=>e.token==p)),S=function(e){let t=e.reduce(((e,t)=>e+t.price*t.count),0);const s=e[0]?.discount?(1-e[0].discount)*t:t;return{subtotal:t.toFixed(2),discount:100*(e[0]?.discount||0),shipping:30,total:(s+30).toFixed(2)}}(v),I=document.getElementById("address").value,L=document.getElementById("address2").value,E=document.getElementById("city").value;function g(){const e=document.querySelector('input[name="paymentMethod"]:checked');return e?e.id:null}if(y){const x={orderId:y.orders?.length+1||1,products:v,date:(new Date).toISOString(),userId:y.userId,address:I,address2:L,city:E,orderStatus:"waiting",paymentMethod:g(),subtotal:S.subtotal,discount:`${S.discount}%`,shipping:S.shipping,total:S.total},{userId:b,...$}=x,w=f.map((e=>e.token===p?{...e,orders:[...e.orders||[],$]}:e)),M=h.map((e=>{const t=v.find((t=>t.id===e.id));if(!t)return e;const s=Math.max(0,e.quantity-(t.count||0));return{...e,quantity:s}}));localStorage.setItem("orders",JSON.stringify([...y.orders||[],x])),localStorage.setItem("users",JSON.stringify(w)),localStorage.setItem("allProducts",JSON.stringify(M)),localStorage.removeItem("cart"),e("success","Order placed successfully!"),setTimeout((()=>open("/customer/home/home.html","_self")),1500)}}})),document.getElementById("cc-number").addEventListener("input",(function(e){let t=e.target.value.replace(/\s/g,"");t.length>16&&(t=t.substring(0,16)),t.length>0&&(t=t.match(/.{1,4}/g)?.join(" ")||t),e.target.value=t})),document.getElementById("cc-expiration").addEventListener("input",(function(e){let t=e.target.value.replace(/\D/g,"");t.length>2&&(t=t.substring(0,2)+"/"+t.substring(2,4)),t.length>5&&(t=t.substring(0,5)),e.target.value=t}))}})),function(){const e=document.querySelector(".checkoutCard"),t=document.querySelector("#checkoutBadge"),s=JSON.parse(localStorage.getItem("cart"))||[];let n,a=0;if(t.innerText=s.length,s.length>0){e.innerHTML="",s.forEach((t=>{const s=document.createElement("li");s.className="list-group-item d-flex justify-content-between align-items-center",a+=(parseFloat(t.price)||0)*t.count,s.innerHTML=`\n        <div class="d-flex align-items-center gap-2">\n          <img src="${t.image}" alt="${t.name}" class="w-25 me-2" />\n          <h6 class="my-0">${t.name}</h6>\n        </div>\n        <span class="text-muted product__price">$${t.price}</span>\n      `,e.appendChild(s)})),n=s[0]?.discount?(1-s[0].discount)*a:a,a=n;const t=document.createElement("li");t.className="list-group-item d-flex justify-content-between align-items-center bg-light",t.innerHTML=`\n      <div class="text-success">\n        <h6 class="my-0">Promo code</h6>\n        <small>EXAMPLECODE</small>\n      </div>\n      <span class="text-success">${s[0]?.discount?100*s[0].discount:0}%</span>\n    `,e.appendChild(t);const i=document.createElement("li");i.className="list-group-item d-flex justify-content-between",i.innerHTML="\n      <span>Shipping (USD)</span>\n      <strong>$30</strong>\n    ",e.appendChild(i);const l=document.createElement("li");l.className="list-group-item d-flex justify-content-between",l.innerHTML=`\n      <span>Total (USD)</span>\n      <strong>$${(30+a).toFixed(2)}</strong>\n    `,e.appendChild(l)}else e.innerHTML='<h4 class="text-center">No products found</h4>'}();